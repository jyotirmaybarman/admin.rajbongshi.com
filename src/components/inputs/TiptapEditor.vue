<template>
    <div 
    class="bg-white border dark:border-gray-600 dark:bg-[#2d2d2d] rounded-t-md"
    :class="{ 'border border-red-500 dark:border-red-500 dark:bg-[#332929] bg-red-50': error }"
    >
        <div class="border-b max-w-[calc(100vw-35px)] overflow-x-auto dark:border-gray-600 rounded-t-md p-2" :class="{'pointer-events-none' : props.disabled}">
            <div class="controls flex items-center gap-4 w-max" v-if="editor">


                <button title="text style" @click="hedingsMenuOpen = !hedingsMenuOpen" class="menubar-btn !bg-blue-200 !text-black">
                    <span class="uppercase text-xs">{{ getCurrentHeadingType }}</span>
                    <ul v-if="hedingsMenuOpen" ref="headingsMenu" class=" bg-gray-200 absolute top-[4.8rem] left-0 p-2 rounded z-50  w-max" role="none">
                        <li
                          v-for="(opt, i) in headingOptions"
                          :key="i"
                          @click="selectHeading(opt.value)"
                          class="text-gray-700 font-normal leading-normal text-left cursor-pointer rounded-md hover:text-indigo-600 hover:bg-gray-100 block px-2 py-1"
                          :class="{ 
                            'text-6xl ': opt.value == 1,
                            'text-5xl ': opt.value == 2,
                            'text-4xl ': opt.value == 3,
                            'text-3xl ': opt.value == 4,
                            'text-2xl ': opt.value == 5,
                            'text-xl ': opt.value == 6,
                            }"
                        >
                          {{ opt.label }}
                        </li>
                    </ul>
                </button>

                <button title="codeblock" class="menubar-btn" @click="editor.chain().focus().toggleCodeBlock().run()" :class="{ 'menubar-btn-active': editor.isActive('codeBlock') }">
                    <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3 h-3">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5" />
                    </svg>                      
                </button>

                <button title="subscript" class="menubar-btn" @click="editor.chain().focus().toggleSubscript().run()" :class="{ 'menubar-btn-active': editor.isActive('subscript') }">  
                    <svg class="w-3 h-3" viewBox="0 0 10 10" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9.90918 10H7.30937C7.25937 10 7.21875 9.95739 7.21875 9.90473V9.73611C7.21875 9.70989 7.22891 9.68612 7.24512 9.66891L8.66523 7.9512C8.79883 7.79016 8.91465 7.63958 9.01211 7.50005C9.10898 7.36176 9.1873 7.23494 9.24727 7.11959C9.30605 7.0065 9.35 6.89873 9.37891 6.79608C9.40723 6.69508 9.42129 6.59755 9.42129 6.50433C9.42129 6.19886 9.34238 5.96243 9.18457 5.79504C9.10703 5.71268 9.01113 5.6506 8.89727 5.60942C8.7791 5.56721 8.64121 5.5459 8.48301 5.5459C8.31543 5.5459 8.16797 5.5711 8.04082 5.6213C7.9166 5.67047 7.81016 5.74423 7.72207 5.84237C7.63322 5.94192 7.56469 6.05946 7.5207 6.18779C7.47578 6.31892 7.45313 6.46664 7.45313 6.63054C7.45313 6.68299 7.4125 6.7256 7.3625 6.7256H7.22598C7.1832 6.7256 7.14746 6.69467 7.1377 6.65308L7.13398 6.64119C7.13105 6.63218 7.12969 6.62296 7.1293 6.61374C7.12402 6.41685 7.15117 6.2341 7.21094 6.06568C7.2709 5.89666 7.36348 5.74238 7.4877 5.60409C7.61191 5.46436 7.7582 5.35905 7.92617 5.28898C8.09199 5.21953 8.27773 5.18449 8.48301 5.18449C8.67324 5.18449 8.84551 5.21318 8.99961 5.27054C9.15547 5.32873 9.29258 5.41621 9.41074 5.533C9.53008 5.64998 9.61992 5.79094 9.67969 5.95505C9.73828 6.11629 9.76777 6.29966 9.76777 6.50433C9.76777 6.63894 9.74648 6.7758 9.70449 6.9143C9.66367 7.05075 9.60156 7.18863 9.51953 7.32795L9.5168 7.33225C9.43594 7.46768 9.34043 7.61171 9.23047 7.76394C9.12031 7.91657 8.99316 8.08089 8.84922 8.25667L7.71992 9.64085H9.90918C9.95938 9.64085 10 9.68346 10 9.73611V9.90473C10 9.95739 9.95938 10 9.90918 10ZM3.41641 3.5264L6.15371 0.0348296C6.17109 0.0124977 6.19922 0.000614641 6.22773 0.000409761L6.62715 0C6.67715 0 6.71777 0.0362638 6.71777 0.0809277C6.71777 0.0997767 6.71035 0.117192 6.69824 0.130918L3.73652 3.89191L6.82734 7.8168C6.85605 7.85306 6.84629 7.90346 6.80547 7.92907C6.78965 7.93911 6.77148 7.94382 6.75332 7.94382L6.3541 7.94403C6.32031 7.94403 6.29102 7.92764 6.2752 7.90326L3.41602 4.2568L0.560156 7.9092C0.542578 7.93153 0.514453 7.94362 0.486133 7.94362L0.0908203 7.94403C0.040625 7.94403 0 7.90776 0 7.8631C0 7.84425 0.00742187 7.82684 0.0195312 7.81311L3.10762 3.89191L0.136914 0.127436C0.108203 0.0909668 0.117969 0.0405663 0.158789 0.0149563C0.174609 0.00491713 0.192969 0.00020488 0.210938 0.00020488L0.616406 0C0.648828 0 0.677148 0.0151611 0.693164 0.0379028L3.41641 3.5264Z" />
                    </svg>              
                </button>

                <button title="superscript" class="menubar-btn" @click="editor.chain().focus().toggleSuperscript().run()" :class="{ 'menubar-btn-active': editor.isActive('superscript') }">
                    <svg class="w-3 h-3" viewBox="0 0 10 10" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9.90933 4.51558H7.30952C7.25933 4.51558 7.21865 4.47556 7.21865 4.42638V4.26809C7.21865 4.2435 7.22897 4.22125 7.24524 4.20525L8.66528 2.59446C8.79881 2.4432 8.91468 2.30229 9.0121 2.17132C9.10893 2.04173 9.1873 1.92267 9.24722 1.81454C9.30615 1.70856 9.35 1.60746 9.37897 1.51105C9.40714 1.41639 9.42123 1.32504 9.42123 1.2378C9.42123 0.951284 9.34226 0.72937 9.18472 0.572449C9.10694 0.49516 9.01111 0.437193 8.89722 0.398353C8.77917 0.358732 8.64107 0.338824 8.48313 0.338824C8.31548 0.338824 8.16806 0.36244 8.04087 0.409478C7.91647 0.455539 7.81012 0.525022 7.72202 0.616949C7.63313 0.710268 7.56466 0.82054 7.52083 0.94094C7.47579 1.06371 7.45318 1.20228 7.45318 1.35588C7.45318 1.40507 7.4125 1.44508 7.3625 1.44508H7.22579C7.18512 1.44508 7.1504 1.41853 7.13909 1.38184L7.13373 1.36584C7.13016 1.35491 7.12877 1.34378 7.12937 1.33324C7.1248 1.15134 7.15198 0.982122 7.21111 0.826372C7.27103 0.667695 7.36349 0.52307 7.4877 0.393278C7.61191 0.262511 7.75814 0.163752 7.92619 0.097978C8.09206 0.0327894 8.27778 0 8.48313 0C8.67341 0 8.84544 0.0269342 8.9996 0.0806074C9.15556 0.135061 9.29266 0.21723 9.41071 0.326723C9.53016 0.436607 9.62004 0.568741 9.67956 0.722539C9.73829 0.8738 9.76786 1.04575 9.76786 1.2378C9.76786 1.36467 9.74663 1.49309 9.70496 1.6221L9.70218 1.62952C9.66071 1.7556 9.5996 1.88266 9.51964 2.00992L9.51687 2.01401C9.43591 2.14107 9.34028 2.27613 9.23056 2.41881C9.12024 2.56187 8.99325 2.71606 8.84921 2.88079L7.72004 4.1789H9.90933C9.95933 4.1789 10 4.21891 10 4.26809V4.42638C10 4.47556 9.95933 4.51558 9.90933 4.51558ZM3.41627 5.85741L6.15357 2.58314C6.17123 2.56226 6.19921 2.55094 6.22778 2.55094L6.62718 2.55055C6.67718 2.55055 6.71786 2.58451 6.71786 2.62628C6.71786 2.64404 6.71052 2.66043 6.69841 2.67332L3.73651 6.19994L6.82738 9.88055C6.85615 9.91471 6.84623 9.96194 6.80556 9.98595C6.78968 9.99532 6.77143 9.9998 6.75337 9.9998L6.35397 10C6.32024 10 6.29087 9.98458 6.2752 9.96175L3.41607 6.54228L0.560119 9.96741C0.542659 9.98829 0.514484 9.99942 0.486111 9.99961L0.0906746 10C0.0406746 10 0 9.96604 0 9.92408C0 9.90651 0.00734127 9.89012 0.0194444 9.87724L3.10774 6.20013L0.136905 2.67C0.108135 2.63584 0.118056 2.58841 0.158929 2.56441C0.174603 2.55523 0.192857 2.55075 0.210913 2.55075L0.616468 2.55055C0.64881 2.55055 0.677183 2.5646 0.693254 2.58588L3.41627 5.85741Z" />
                    </svg>                                             
                </button>

                <button title="bold" class="menubar-btn" @click="editor.chain().focus().toggleBold().run()" :class="{ 'menubar-btn-active': editor.isActive('bold') }">
                    <svg class="w-3 h-3"  viewBox="0 0 7 10" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 10V0H2.89822C4.08391 0 4.98012 0.217939 5.58708 0.656359C6.19683 1.09478 6.4988 1.73003 6.4988 2.56445C6.4988 3.16921 6.33102 3.67096 5.99265 4.06931C5.65428 4.46786 5.17892 4.72332 4.56163 4.83356C5.25905 4.91566 5.84037 5.18755 6.30258 5.65392C6.7676 6.11814 7 6.65018 7 7.2479C7 8.09894 6.69523 8.77153 6.08828 9.26155C5.47874 9.75391 4.634 10 3.54911 10H0ZM0.408154 5.06323V9.63429H3.59305C4.52803 9.63429 5.25905 9.42574 5.79363 9.00608C6.32585 8.58642 6.59185 8.00512 6.59185 7.26198C6.59185 6.63142 6.3336 6.10876 5.81948 5.69848C5.30557 5.28821 4.61591 5.07731 3.75308 5.06323H0.408154ZM0.408154 4.69752H3.05049C4.05289 4.69752 4.80954 4.5218 5.31849 4.17017C5.82981 3.81853 6.08311 3.27476 6.08311 2.53396C6.08311 1.1112 5.05249 0.389164 2.98868 0.365708H0.408154V4.69752Z" />
                    </svg>
                </button>

                <button title="underline" class="menubar-btn" @click="editor.chain().focus().toggleUnderline().run()" :class="{ 'menubar-btn-active': editor.isActive('underline') }">
                    <svg class="w-3 h-3" viewBox="0 0 6 8" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5.6846 0.0408395V4.56025C5.6846 4.93688 5.62248 5.27001 5.49876 5.55902C5.37416 5.84959 5.18708 6.09541 4.93823 6.29648C4.68956 6.49708 4.40354 6.64792 4.08035 6.74853C3.75805 6.84883 3.39876 6.89921 3.00265 6.89921C2.60354 6.89921 2.2423 6.84883 1.91894 6.74837C1.59381 6.64745 1.30743 6.49598 1.05982 6.2946C0.811327 6.09244 0.624779 5.8463 0.500708 5.55636C0.377168 5.26751 0.315398 4.93547 0.315398 4.56025V0.0408395C0.315398 0.0183074 0.336106 0 0.361593 0H0.647611C0.67292 0 0.693805 0.0183074 0.693805 0.0408395V4.56025C0.693805 4.87555 0.747434 5.15626 0.854867 5.40176C0.961593 5.64618 1.12212 5.85679 1.33611 6.03313C1.55133 6.21042 1.79735 6.34295 2.07398 6.43089C2.35133 6.51914 2.66088 6.56311 3.00265 6.56311C3.34265 6.56311 3.6508 6.51914 3.92726 6.43089C4.20301 6.34295 4.44867 6.21042 4.66389 6.03313C4.87788 5.85679 5.03823 5.64618 5.14513 5.40176C5.25257 5.15626 5.30619 4.87555 5.30619 4.56025V0.0408395C5.30619 0.0183074 5.3269 0 5.35239 0H5.63841C5.66389 0 5.6846 0.0183074 5.6846 0.0408395ZM0 7.69457H6V8H0V7.69457Z" />
                    </svg>
                </button>

                <button title="blockquote" class="menubar-btn" @click="editor.chain().focus().toggleBlockquote().run()" :class="{ 'menubar-btn-active': editor.isActive('blockquote') }">
                    <svg class="w-3 h-3" viewBox="0 0 9 8" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6.74843 0C7.49744 0 8.06257 0.312082 8.44314 0.936023C8.62929 1.24097 8.76886 1.58761 8.86168 1.97548C8.95396 2.36023 9.00002 2.78333 9.00002 3.24387C9.00002 3.76661 8.94253 4.2646 8.82757 4.73785C8.71244 5.21132 8.54017 5.65738 8.31113 6.07557C8.08173 6.49398 7.80189 6.86313 7.4716 7.18257C7.14341 7.5 6.76566 7.76772 6.33886 7.98573C6.31439 7.99816 6.28783 8.0025 6.26167 7.99837C6.2355 7.99424 6.2106 7.98176 6.18927 7.9621L4.63378 6.70129C4.56136 6.64267 4.54009 6.52073 4.58632 6.42911C4.60333 6.39496 4.62826 6.36833 4.65769 6.35288C4.95019 6.19728 5.21509 6.03901 5.45205 5.87807C5.68882 5.71712 5.89994 5.55216 6.08521 5.38342C6.26486 5.2198 6.4199 5.03923 6.55015 4.84173C6.59339 4.77642 6.63382 4.70932 6.67144 4.64044C6.5897 4.67276 6.50251 4.68881 6.40988 4.68881C6.17222 4.68881 5.94863 4.64133 5.73945 4.54681C5.52974 4.4523 5.33568 4.3103 5.15726 4.12104C4.97392 3.92688 4.83628 3.68926 4.7447 3.40905C4.6547 3.13375 4.60953 2.81966 4.60953 2.46701C4.60953 2.06197 4.65699 1.70508 4.75156 1.39679C4.84841 1.0807 4.99449 0.817878 5.1889 0.609229C5.37962 0.404815 5.60709 0.251449 5.87111 0.149799C6.13021 0.0499331 6.42271 0 6.74843 0ZM8.19687 1.17722C7.87906 0.656487 7.39619 0.395898 6.74843 0.395898C6.45084 0.395898 6.18839 0.439813 5.96128 0.527196C5.73927 0.612795 5.54873 0.740749 5.39017 0.911057C5.23566 1.07691 5.11929 1.28645 5.04177 1.53923C4.96179 1.79982 4.92171 2.10923 4.92171 2.46701C4.92171 2.76839 4.9588 3.0321 5.03246 3.25747C5.1047 3.47793 5.21298 3.66496 5.3573 3.81788C5.50654 3.97615 5.66878 4.09496 5.84369 4.1741C6.01859 4.25323 6.20738 4.29291 6.40988 4.29291C6.56896 4.29291 6.70291 4.21846 6.81154 4.07C6.86673 3.99554 6.95867 3.98596 7.02265 4.0506L7.1007 4.12996C7.15642 4.18391 7.17804 4.2811 7.14834 4.36603C7.05605 4.62974 6.93617 4.87294 6.78939 5.09541C6.64314 5.31699 6.46894 5.51984 6.26697 5.70375C6.0708 5.8823 5.84791 6.05662 5.59847 6.22604C5.42656 6.34284 5.24287 6.45698 5.04757 6.56866L6.29632 7.58092C6.66669 7.38364 6.99541 7.14623 7.28246 6.8687C7.58621 6.5749 7.84355 6.23518 8.05484 5.84976C8.2663 5.46389 8.42468 5.05439 8.5298 4.62194C8.63509 4.18881 8.68783 3.72938 8.68783 3.24387C8.68783 2.81877 8.64652 2.43402 8.56408 2.09006C8.48252 1.749 8.36 1.44449 8.19687 1.17722ZM2.18656 0C2.93574 0 3.5007 0.312082 3.88144 0.936023C4.06742 1.24097 4.20699 1.58761 4.29998 1.97548C4.39208 2.36023 4.43832 2.78333 4.43832 3.24387C4.43832 4.29336 4.20857 5.23741 3.74925 6.07557C3.52003 6.49398 3.24001 6.86313 2.90972 7.18257C2.58171 7.5 2.20396 7.76772 1.77699 7.98573C1.75251 7.99814 1.72595 8.00248 1.69979 7.99835C1.67363 7.99422 1.64873 7.98175 1.6274 7.9621L0.0719093 6.70129C-0.000512545 6.64267 -0.0217821 6.52073 0.0244484 6.42911C0.0414549 6.39496 0.0663867 6.36833 0.0958156 6.35288C0.388316 6.19728 0.653218 6.03901 0.890347 5.87807C1.12712 5.71712 1.33824 5.55216 1.52351 5.38342C1.70298 5.2198 1.85802 5.03923 1.98845 4.84173C2.03187 4.77597 2.07248 4.70843 2.11044 4.6391C2.02765 4.67209 1.94011 4.68881 1.848 4.68881C1.61 4.68881 1.38623 4.64133 1.17705 4.54681L1.16931 4.54302C0.962593 4.44806 0.771343 4.3074 0.595562 4.12104C0.412222 3.92688 0.274585 3.68926 0.182827 3.40905C0.0928273 3.13375 0.0478273 2.81966 0.0478273 2.46701C0.0478273 2.06197 0.0951125 1.70508 0.189683 1.39679C0.286714 1.0807 0.432612 0.817878 0.627202 0.609229C0.817749 0.404815 1.04521 0.251449 1.30923 0.149799C1.56834 0.0499331 1.86101 0 2.18656 0ZM3.635 1.17722C3.31718 0.656487 2.83449 0.395898 2.18656 0.395898C1.88896 0.395898 1.62652 0.439813 1.39959 0.527196C1.1774 0.612795 0.987027 0.740749 0.828472 0.911057C0.673784 1.07691 0.557593 1.28645 0.480073 1.53923C0.400093 1.79982 0.360015 2.10923 0.360015 2.46701C0.360015 2.76839 0.396929 3.0321 0.470757 3.25747C0.542827 3.47793 0.651284 3.66496 0.795601 3.81788C0.943257 3.97459 1.10322 4.09229 1.27496 4.1712L1.28199 4.1741C1.45689 4.25323 1.64568 4.29291 1.848 4.29291C1.92904 4.29291 2.00251 4.27463 2.06791 4.2383C2.13382 4.20174 2.19464 4.14556 2.24984 4.07C2.30503 3.99554 2.39697 3.98596 2.46078 4.0506L2.539 4.12996C2.56666 4.15684 2.58639 4.19473 2.59503 4.23754C2.60366 4.28035 2.60071 4.3256 2.58664 4.36603C2.49443 4.62926 2.37354 4.87478 2.22751 5.09541C2.08126 5.31699 1.90707 5.51984 1.70527 5.70375C1.5091 5.8823 1.28603 6.05662 1.0366 6.22604C0.864683 6.34284 0.681167 6.45698 0.485698 6.56866L1.73445 7.58092C2.10482 7.38364 2.43371 7.14623 2.72058 6.8687C3.02433 6.5749 3.28185 6.23518 3.49314 5.84976C3.91501 5.0798 4.12595 4.2111 4.12595 3.24387C4.12595 2.81877 4.08482 2.43402 4.00238 2.09006C3.92064 1.749 3.79812 1.44449 3.635 1.17722Z" />
                    </svg> 
                </button>
                <button title="italic" class="menubar-btn" @click="editor.chain().focus().toggleItalic().run()" :class="{ 'menubar-btn-active': editor.isActive('italic') }">
                    <svg class="w-3 h-3" viewBox="0 0 10 10" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3.60364 0.507455C3.4209 0.507455 3.3057 0.393927 3.34668 0.253825C3.38766 0.113723 3.56936 0 3.75235 0H9.73456C9.91755 0 10.0328 0.113528 9.99178 0.25363C9.9508 0.393732 9.7691 0.507455 9.58611 0.507455H6.91755L3.75467 9.49255H6.39616C6.57915 9.49255 6.6941 9.60627 6.65338 9.74618C6.6124 9.88628 6.4307 10 6.24771 10H0.265492C0.0825024 10 -0.0327038 9.88647 0.00827562 9.74637C0.049255 9.60646 0.230956 9.49255 0.413946 9.49255H3.0856L6.24874 0.507455H3.60364Z" />
                    </svg>
                </button>
                <button title="unordered list" class="menubar-btn" @click="editor.chain().focus().toggleBulletList().run()" :class="{ 'menubar-btn-active': editor.isActive('bulletList') }">
                    <svg class="w-3 h-3" viewBox="0 0 10 7" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1.7916 0H10V0.678363H1.7916V0ZM0 0H0.616211V0.678363H0V0ZM0 3.08595H0.616211V3.76432H0V3.08595ZM0 6.23568H0.616211V6.91405H0V6.23568ZM1.81387 6.23568H9.97793V6.91405H1.81387V6.23568ZM1.81387 3.08595H9.97793V3.76432H1.81387V3.08595Z"/>
                    </svg>                        
                </button>
                <button title="ordered list" class="menubar-btn" @click="editor.chain().focus().toggleOrderedList().run()" :class="{ 'menubar-btn-active': editor.isActive('orderedList') }">
                    <svg class="w-3 h-3" viewBox="0 0 8 7" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M2.34458 6.36792H7.76125V5.67208H2.34458V6.36792ZM2.34458 3.86792H7.76125V3.25917H2.34458V3.86792ZM2.34458 0.534583V1.16849H7.76125V0.534583H2.34458ZM0.500833 0.639583C0.545417 0.599583 0.582917 0.56125 0.613333 0.525C0.607917 0.62 0.605 0.725 0.605 0.84V1.78458H1.095V0H0.66125L0.0475 0.499167L0.2975 0.806667L0.500833 0.639583ZM0.64 3.87458C0.8375 3.69708 0.966667 3.57667 1.0275 3.51333C1.08792 3.44958 1.13583 3.38917 1.17333 3.33167C1.20958 3.27417 1.23667 3.21583 1.25417 3.15667C1.27167 3.09708 1.28042 3.0325 1.28042 2.9625C1.28042 2.86875 1.25542 2.78458 1.20542 2.70917C1.15542 2.63375 1.08458 2.57583 0.994167 2.53542C0.903333 2.49375 0.800417 2.47375 0.685 2.47375C0.593334 2.47375 0.51 2.48292 0.436667 2.50167C0.363333 2.52042 0.295 2.5475 0.2325 2.58292C0.17 2.61833 0.0920833 2.67708 0 2.75917L0.265 3.06917C0.3375 3.00667 0.4025 2.95917 0.459583 2.9275C0.517083 2.895 0.57375 2.87875 0.630417 2.87875C0.684583 2.87875 0.727083 2.89208 0.757083 2.91917C0.7875 2.94583 0.802917 2.9825 0.802917 3.02917C0.802917 3.06667 0.794583 3.1025 0.78 3.13667C0.765 3.17083 0.738333 3.21167 0.7 3.25917C0.661667 3.30667 0.580417 3.39583 0.455833 3.52583L0.0195834 3.96708V4.28458H1.31542V3.88667H0.640417L0.64 3.87458ZM0.860833 5.85208V5.84458C0.988333 5.80875 1.08583 5.75083 1.15333 5.67208C1.22083 5.59292 1.25458 5.49708 1.25458 5.38667C1.25458 5.2575 1.20208 5.1575 1.09708 5.08375C0.992083 5.01042 0.847083 4.97375 0.6625 4.97375C0.534583 4.97375 0.420833 4.9875 0.3225 5.01542C0.224167 5.04333 0.126667 5.08958 0.0325 5.15458L0.2325 5.47667C0.354583 5.40042 0.4725 5.3625 0.586667 5.3625C0.647917 5.3625 0.69625 5.37375 0.7325 5.39667C0.76875 5.41958 0.786667 5.455 0.786667 5.50167C0.786667 5.62667 0.664167 5.68917 0.419167 5.68917H0.306667V6.05167H0.416667C0.507083 6.05167 0.580417 6.05875 0.63625 6.0725C0.692917 6.085 0.733333 6.10583 0.75875 6.13208C0.78375 6.15875 0.79625 6.19625 0.79625 6.24458C0.79625 6.30833 0.7725 6.355 0.724167 6.385C0.67625 6.41417 0.599167 6.42917 0.493333 6.42917C0.425 6.42917 0.350417 6.42 0.269167 6.4C0.188333 6.38167 0.10875 6.35208 0.0304167 6.3125V6.7125C0.125417 6.74917 0.21375 6.77417 0.295833 6.78833C0.3775 6.80208 0.466667 6.80917 0.5625 6.80917C0.795833 6.80917 0.978333 6.76167 1.11 6.66625C1.24125 6.57125 1.30708 6.44042 1.30708 6.27458C1.30792 6.03083 1.15833 5.88958 0.860833 5.85208Z" />
                    </svg>
                </button>

                <button title="highlight" class="menubar-btn" @click="editor.chain().focus().toggleHighlight().run()" :class="{ 'menubar-btn-active': editor.isActive('highlight') }">
                    <svg class="h-3 w-3" viewBox="0 0 10 10" fill="currentColor">
                        <path d="M2.47047 4.97477L5.34246 8.11089C5.38071 8.14643 5.42954 8.16599 5.47675 8.16599C5.51825 8.16599 5.55731 8.15177 5.5858 8.12066L5.59312 8.11267L9.50601 3.1139C9.5467 3.06236 9.56867 2.99926 9.56867 2.93883C9.56867 2.88907 9.55239 2.8393 9.5174 2.80109L7.43319 0.525204C7.39901 0.48788 7.35587 0.470995 7.31111 0.470995C7.25333 0.470995 7.19392 0.495878 7.14265 0.5412L2.45337 4.69218L2.44442 4.70195C2.41838 4.73039 2.40699 4.77038 2.40699 4.81304C2.40699 4.86458 2.42408 4.91701 2.455 4.95878L2.47047 4.97477ZM7.90684 3.36095C7.99066 3.26942 8.12738 3.26942 8.21202 3.36095C8.29585 3.45248 8.29585 3.60178 8.21202 3.6942L6.13513 5.9612C6.05131 6.05273 5.91458 6.05273 5.82995 5.9612C5.74612 5.86966 5.74612 5.72037 5.82995 5.62795L7.90684 3.36095ZM6.65842 1.99862C6.74225 1.90709 6.87897 1.90709 6.96361 1.99862C7.04743 2.09015 7.04743 2.23945 6.96361 2.33187L4.88753 4.59887C4.80371 4.6904 4.66699 4.6904 4.58235 4.59887C4.49852 4.50733 4.49852 4.35804 4.58235 4.26561L6.65842 1.99862ZM2.49325 9.40213L2.00902 9.93088C1.95775 9.98687 1.88695 10.0091 1.82022 9.99665L0.191747 9.80025C0.0737417 9.78603 -0.0117102 9.66962 0.00131108 9.54076C0.00700787 9.48566 0.0297951 9.43678 0.063162 9.40035L1.27739 8.07445L1.19031 7.97937C1.10649 7.88783 1.10649 7.73854 1.19031 7.64611L1.572 7.22933L1.57281 7.23022L1.57851 7.224C1.59397 7.208 1.60862 7.18934 1.62246 7.1689C1.63548 7.14935 1.64687 7.12624 1.65745 7.10225C1.73232 6.9254 1.7014 6.54416 1.67698 6.24646H1.6778C1.67047 6.16115 1.66478 6.08206 1.66152 6.02785C1.61595 5.63505 1.84545 5.40756 2.07576 5.18272C2.01309 5.07164 1.97973 4.94367 1.97891 4.81748C1.97729 4.65396 2.02937 4.49134 2.14086 4.36959C2.15144 4.35804 2.16528 4.34471 2.18318 4.32871L6.87165 0.176845C7.00023 0.0622069 7.15649 0 7.31111 0C7.46574 0 7.61793 0.0604295 7.73837 0.191953L9.82259 2.46784C9.94303 2.59936 10 2.76732 10 2.93794C10 3.10768 9.94222 3.28008 9.83317 3.41871L5.92028 8.41837C5.90807 8.43436 5.89749 8.44681 5.89098 8.45391C5.77705 8.57833 5.62568 8.63698 5.47349 8.6352C5.35874 8.63431 5.24236 8.59877 5.14226 8.53123C4.93636 8.78361 4.72802 9.03333 4.36831 8.98356C4.29425 8.97912 4.23322 8.9729 4.16811 8.96668V8.96579C3.89548 8.93913 3.54716 8.90536 3.38439 8.98801C3.36161 8.99956 3.34126 9.012 3.32336 9.02622C3.30871 9.03777 3.29406 9.0511 3.28022 9.06621C3.27615 9.07154 3.27209 9.07687 3.2672 9.08132L2.88552 9.4981C2.80169 9.58963 2.66497 9.58963 2.58033 9.4981L2.49325 9.40213ZM1.64687 7.81141L1.73395 7.90649L2.64544 8.9018L2.73252 8.99689L2.96771 8.74007C3.00027 8.70363 3.03526 8.67075 3.0727 8.64142C3.1142 8.60943 3.15815 8.58188 3.20291 8.55878C3.46822 8.42459 3.88083 8.46458 4.20392 8.49657V8.49568C4.28367 8.50368 4.35773 8.51079 4.39924 8.51346L4.41714 8.51523C4.55793 8.53567 4.6914 8.37305 4.82405 8.21042L2.36629 5.52753C2.21736 5.67238 2.06762 5.81901 2.08797 5.97275L2.08959 5.99141C2.09366 6.06784 2.09936 6.13449 2.10506 6.20469H2.10587C2.13435 6.55661 2.17098 7.00716 2.04809 7.29776C2.02693 7.34663 2.00251 7.39462 1.9724 7.43994C1.94473 7.48171 1.91299 7.52259 1.87556 7.5608L1.87637 7.56169L1.64687 7.81141Z"/>
                    </svg>
                </button>

                <button title="align left" class="menubar-btn"  @click="editor.chain().focus().setTextAlign('left').run()" :class="{ 'menubar-btn-active': editor.isActive({ textAlign: 'left' }) }">
                    <svg class="h-3 w-3" viewBox="0 0 10 10" fill="currentColor" >
                        <path d="M0 0H7.02715V0.708019H0V0ZM0 3.09715H10V3.80571H0V3.09715ZM0.000195312 6.19456H3.5748V6.90285H0.000195312V6.19456ZM0 9.29198H5.90664V10H0V9.29198Z" />
                    </svg> 
                </button>

                <button title="align center" class="menubar-btn" @click="editor.chain().focus().setTextAlign('center').run()" :class="{ 'menubar-btn-active': editor.isActive({ textAlign: 'center' }) }">
                    <svg class="h-3 w-3"  viewBox="0 0 10 10" fill="currentColor" >
                        <path d="M1.77441 0H8.22559V0.708193H1.77441V0ZM0 3.09893H10V3.80361H0V3.09893ZM3.35918 6.19464H6.64082V6.90283H3.35918V6.19464ZM2.28867 9.2921H7.71133V10H2.28867V9.2921Z" />
                    </svg>
                        
                </button>

                <button title="align right" class="menubar-btn" @click="editor.chain().focus().setTextAlign('right').run()" :class="{ 'menubar-btn-active': editor.isActive({ textAlign: 'right' }) }">
                    <svg class="h-3 w-3" viewBox="0 0 10 10" fill="currentColor"  xmlns="http://www.w3.org/2000/svg">
                        <path d="M2.3457 0H10V0.708056H2.3457V0ZM0 3.10003H10V3.80241H0V3.10003ZM6.10625 6.19438H10V6.90293H6.10625V6.19438ZM3.56621 9.29194H10V10H3.56621V9.29194Z" />
                    </svg>
                        
                </button>

                <button title="align justify" class="menubar-btn" @click="editor.chain().focus().setTextAlign('justify').run()" :class="{ 'menubar-btn-active': editor.isActive({ textAlign: 'justify' }) }">
                    <svg class="h-3 w-3" viewBox="0 0 10 10" fill="currentColor"  xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 0H9.97559V0.706154H0V0ZM0 3.09567H10V3.80524H0V3.09567ZM0 6.19333H10V6.90262H0V6.19333ZM0 9.29071H6.95566V10H0V9.29071Z" />
                    </svg>
                </button>
            </div>
        </div>
        <editor-content :class="{ 'dark:bg-[#332929] bg-red-50': error }" :editor="editor" />
    </div>
</template>

<script setup>
import { useEditor, EditorContent } from '@tiptap/vue-3'
import Placeholder from '@tiptap/extension-placeholder'
import StarterKit from '@tiptap/starter-kit'
import Underline from '@tiptap/extension-underline'
import { computed, onBeforeUnmount, onMounted, watch, ref } from 'vue';
import Typography from '@tiptap/extension-typography'
import { onClickOutside } from '@vueuse/core';
import { lowlight } from 'lowlight/lib/core'
import { CodeBlockLowlight } from '@tiptap/extension-code-block-lowlight'
import { Highlight } from '@tiptap/extension-highlight'
import { TextAlign } from "@tiptap/extension-text-align"
import { Link } from "@tiptap/extension-link"
import Subscript from '@tiptap/extension-subscript'
import Superscript from '@tiptap/extension-superscript'
import css from 'highlight.js/lib/languages/css'
import js from 'highlight.js/lib/languages/javascript'
import ts from 'highlight.js/lib/languages/typescript'
import html from 'highlight.js/lib/languages/xml'
import 'highlight.js/styles/base16/darcula.css'

// props & emits
const props = defineProps({
    modelValue:{
        type: String,
        required:true
    },
    error: {
        type: Boolean,
        default: false
    },
    placeholder:{
        type: String,
        default: "write something..."
    },
    disabled:{
        type:Boolean,
        default:false
    },
    class:{
        type:String,
        default: ''
    }
})
const emits = defineEmits(['update:modelValue', 'change'])


// variables
lowlight.registerLanguage('html', html)
lowlight.registerLanguage('css', css)
lowlight.registerLanguage('js', js)
lowlight.registerLanguage('ts', ts)

const error = ref(false)

const hedingsMenuOpen = ref(false)

const headingOptions = [
    {
        label: 'Paragraph',
        value: 'p',
    },
    {
        label: 'Headings 6',
        value: 6,
    },
    {
        label: 'Headings 5',
        value: 5,
    },
    {
        label: 'Headings 4',
        value: 4,
    },
    {
        label: 'Headings 3',
        value: 3,
    },
    {
        label: 'Headings 2',
        value: 2,
    },
    {
        label: 'Headings 1',
        value: 1,
    },
    
]

const headingsMenu = ref()

// computed & watchers
const getContent = computed(()=>{
    if(props.modelValue){
        return props.modelValue
    }
    return "<p>Please enter your content</p>"
});

watch(()=> props.modelValue, (nv)=>{
    const isSame = editor.value.getHTML() === nv
    if (isSame) {
        return
    }
    editor.value.commands.setContent(nv, false)
})

watch(()=> props.disabled, (nv)=>{
    if(nv){
        disableEditor()
    }
})

watch(()=> props.error, (nv)=>{
    error.value = nv
})

onClickOutside(headingsMenu, ()=>hedingsMenuOpen.value = false)

const getCurrentHeadingType = computed(()=>{
    let current = "p"
    for (let i=1; i<7; i++) {
        if(editor.value.isActive('heading', { level: i })){
            current = "h"+i;
        }
    } 
    return current;
})


const editor = useEditor({
    content: getContent.value,
    extensions: [
        StarterKit,
        Underline,
        Typography,
        Placeholder.configure({
            placeholder: props.placeholder,
        }),
        CodeBlockLowlight.configure({
            lowlight
        }),
        Highlight.configure({
            multicolor: true
        }),
        TextAlign.configure({
            types: ['heading', 'paragraph'],
        }),
        Link.configure({
            protocols: ['ftp', 'mailto'],
            autolink: true
        }),
        Subscript,
        Superscript
    ],
    editorProps: {
        attributes: {
            class: props.class + ' min-h-[100px] prose prose-blue max-w-none p-3 focus:outline-none dark:prose-invert block overflow-y-auto',
        },
    },
    onUpdate: ({ editor }) => {
        emits('update:modelValue', editor.getHTML());
        emits('change', editor.getHTML());
    },
});







// functions
function disableEditor(){
    editor.value.setOptions({
        editable: false,
        editorProps: {
            attributes:{
                class: props.class + ' bg-gray-50 cursor-not-allowed min-h-[100px] max-h-[250px] border prose max-w-none p-3 focus:outline-none block overflow-y-auto',
            }
        }
    })
}

function selectHeading(size){
    if(typeof size === "number"){
        editor.value.chain().focus().toggleHeading({ level: size }).run()
    }else{
        editor.value.chain().focus().setParagraph().run()
    }
}


// lifecycles

onMounted(()=>{
    editor.value.commands.setContent(props.modelValue, false)
    if(props.disabled){
        disableEditor()
    }
})


onBeforeUnmount(()=>{
    editor.value.destroy();
})
</script>

<style lang="postcss" scoped>

.menubar-btn{
    @apply bg-gray-100 dark:bg-[#3e3e3e] dark:fill-white text-sm hover:bg-blue-200 dark:hover:bg-blue-200 dark:hover:text-black h-7 w-7 rounded-md flex items-center justify-center;
}
.menubar-btn-active{
    @apply bg-blue-200 dark:bg-blue-200 dark:text-black;
}
p.is-editor-empty:first-child::before {
    content: attr(data-placeholder);
    float: left;
    color: #adb5bd;
    pointer-events: none;
    height: 0;
}
</style>